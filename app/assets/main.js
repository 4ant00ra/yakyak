// Generated by CoffeeScript 1.9.2
(function() {
  var BrowserWindow, Client, Q, app, client, loadAppWindow, login, mainWindow;

  Client = require('hangupsjs');

  Q = require('q');

  login = require('./login');

  client = new Client();

  app = require('app');

  BrowserWindow = require('browser-window');

  mainWindow = null;

  app.on('window-all-closed', function() {
    return app.quit();
  });

  loadAppWindow = function() {
    return mainWindow.loadUrl('file://' + __dirname + '/index.html');
  };

  app.on('ready', function() {
    var creds;
    mainWindow = new BrowserWindow({
      width: 940,
      height: 600,
      "min-width": 620,
      "min-height": 420
    });
    mainWindow.openDevTools({
      detach: true
    });
    loadAppWindow();
    creds = function() {
      var prom;
      prom = login(mainWindow);
      prom.then(function() {
        return loadAppWindow();
      });
      return {
        auth: function() {
          return prom;
        }
      };
    };
    client.connect(creds).then(function() {
      return console.log('connected');
    }).done();
    return mainWindow.on('closed', function() {
      return mainWindow = null;
    });
  });

}).call(this);
