// Generated by CoffeeScript 1.9.2
(function() {
  var Client, Q;

  Client = require('hangupsjs');

  Q = require('q');

  module.exports = function(mainWindow) {
    return Q.Promise(function(rs) {
      var onDidFinishLoad;
      mainWindow.loadUrl(Client.OAUTH2_LOGIN_URL);
      return mainWindow.webContents.on('did-finish-load', onDidFinishLoad = function() {
        var code, scr, title, url;
        url = mainWindow.getUrl();
        if (url.indexOf('&response_type=code') > 0) {
          scr = "document.getElementById('connect_approve').submit()";
          mainWindow.webContents.executeJavaScript(scr);
        }
        if (url.indexOf('/o/oauth2/approval') > 0) {
          title = mainWindow.webContents.getTitle();
          code = title.substring(13);
          mainWindow.webContents.removeListener('did-finish-load', onDidFinishLoad);
          return rs(code);
        }
      });
    });
  };

}).call(this);
